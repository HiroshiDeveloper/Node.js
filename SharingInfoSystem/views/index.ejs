<!DOCTYPE html>
<html>
  <head>
  	<title><%= title %></title>
    
    	<!-- bootstrap -->
    	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    	<!-- css -->
    	<link rel='stylesheet' href='/stylesheets/style.css'/>
    	<link rel='stylesheet' href='/stylesheets/index.css'/>
	
	<script type="text/javascript">
                $(document).on('click', '.delete' ,function(){
			if(window.confirm('Are you sure to delete "'+ $(this).data('name') + '" board?')){
				var cmd = $(this).data('cmd');
				$.ajax({
					url: '/',
					data: { boardId: cmd},
					type: 'delete',
					success: function() {
						location.reload(false);	
   					},
					error: function() {
						alert('error!!');
					}
				});
			}else{
				window.alert('Canceled');
			}
		});

		$(document).on('click', '#fileBtn', function(){
			var boardText = document.getElementById("boardText").value;
			console.log(boardText);
			if(!boardText){
				alert("Please type the board title");
				return false;
			}
			/*
			else{
				$("#boardBtn").click();		
			}
			*/
		})
		
		$(document).ready(function(){
			$("#fileBtn").on('change',function(){
				$("#boardBtn").click();		
			});
		});

        </script>

  </head>
  
  <body class="dashBoardBody">
	<div class="rightText margin10">
		<% if (typeof user !== 'undefined') { %>
			<span class="login-user">Log in as <%= user.user_name %></span><br/>
			<a href="/logout">Log out</a>
		<% } %>
	</div>
    	<div class="wrapperBoard">
		<form action="/" method="post" enctype="multipart/form-data" class="board-form">
			<h3>Create a Board</h3>
			<input id="boardText" type="text" name="title" class="input form-control" placeholder="Enter Title" required>
			
			<button id="boardBtn" type="submit" class="btn" style="display:none">Create</button>
			<label class="addPic right btn btn-info">
				Create
				<input id="fileBtn" type="file" name="image_file" class="right file" style="display:none">
			</label>
		</form><br/><br/><br/>

		<ul class="main-list list-group">
			<% boardList.forEach(function(boardItem) { %>
				<li class="main-list__item list-group-item">
					<% if (boardItem.image_path) { %>
						<img src="<%= boardItem.image_path %>" class="img-circle icon" alt="Cinque Terre" width="50" height="50">
					<% } %>
					
					<a href="/boards/<%= boardItem.board_id %>">
						<label class="board__title"><%= boardItem.title %></label>
					</a>
					<button class="right delete" data-cmd="<%= boardItem.board_id %>" data-name="<%= boardItem.title %>">X</button>
					<p class="board__date rightText"><%= boardItem.user_name %><br/><%= boardItem.created_at %></p>
				</li>
			<% }); %>
		</ul>
    	</div>

	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    	<script src="/socket.io/socket.io.js"></script>
    	<script>
    		var socket = io.connect();
    		$('button').on('click', function() {
    			socket.emit('request');
   		});
    		socket.on('response', function() {
    			alert('Get Response!!');
    		});
    	</script>
</body>
</html>
